(self.webpackChunksocio=self.webpackChunksocio||[]).push([[592],{1020:(e,t,n)=>{"use strict";n.d(t,{o:()=>c});var s=n(8512),a=n(878),i=n(6599),r=n(611),d=n(4689),p=n(9996),l=n(5366),h=n(2693);let c=(()=>{class e{constructor(e){this._httpClient=e,this._calendars=new s.X(null),this._events=new s.X(null),this._loadedEventsRange={start:null,end:null},this._numberOfDaysToPrefetch=60,this._settings=new s.X(null),this._weekdays=new s.X(null)}get calendars$(){return this._calendars.asObservable()}get events$(){return this._events.asObservable()}get settings$(){return this._settings.asObservable()}get weekdays$(){return this._weekdays.asObservable()}getCalendars(){return this._httpClient.get("api/apps/calendar/calendars").pipe((0,i.b)(e=>{this._calendars.next(e)}))}addCalendar(e){return this.calendars$.pipe((0,r.q)(1),(0,d.w)(t=>this._httpClient.post("api/apps/calendar/calendars",{calendar:e}).pipe((0,p.U)(e=>(t.push(e),this._calendars.next(t),e)))))}updateCalendar(e,t){return this.calendars$.pipe((0,r.q)(1),(0,d.w)(n=>this._httpClient.patch("api/apps/calendar/calendars",{id:e,calendar:t}).pipe((0,p.U)(t=>{const s=n.findIndex(t=>t.id===e);return n[s]=t,this._calendars.next(n),t}))))}deleteCalendar(e){return this.calendars$.pipe((0,r.q)(1),(0,d.w)(t=>this._httpClient.delete("api/apps/calendar/calendars",{params:{id:e}}).pipe((0,p.U)(n=>{const s=t.findIndex(t=>t.id===e);t.splice(s,1),this._calendars.next(t);const a=this._events.value.filter(t=>t.calendarId!==e);return this._events.next(a),n}))))}getEvents(e,t,n=!1){return(n||!this._loadedEventsRange.start||e.isBefore(this._loadedEventsRange.start))&&(this._loadedEventsRange.start=e),(n||!this._loadedEventsRange.end||t.isAfter(this._loadedEventsRange.end))&&(this._loadedEventsRange.end=t),this._httpClient.get("api/apps/calendar/events",{params:{start:e.toISOString(!0),end:t.toISOString(!0)}}).pipe((0,d.w)(e=>this._events.pipe((0,r.q)(1),(0,p.U)(t=>(n?this._events.next(e):(t=t||[],this._events.next([...t,...e])),e)))))}reloadEvents(){return this._httpClient.get("api/apps/calendar/events",{params:{start:this._loadedEventsRange.start.toISOString(),end:this._loadedEventsRange.end.toISOString()}}).pipe((0,p.U)(e=>(this._events.next(e),e)))}prefetchFutureEvents(e){const t=this._loadedEventsRange.end.diff(e,"days");if(t>=this._numberOfDaysToPrefetch)return(0,a.of)([]);const n=this._loadedEventsRange.end.clone().add(1,"day");return e=this._loadedEventsRange.end.clone().add(this._numberOfDaysToPrefetch-t,"days"),this.getEvents(n,e)}prefetchPastEvents(e){const t=e.diff(this._loadedEventsRange.start,"days");if(t>=this._numberOfDaysToPrefetch)return(0,a.of)([]);e=this._loadedEventsRange.start.clone().subtract(this._numberOfDaysToPrefetch-t,"days");const n=this._loadedEventsRange.start.clone().subtract(1,"day");return this.getEvents(e,n)}addEvent(e){return this.events$.pipe((0,r.q)(1),(0,d.w)(t=>this._httpClient.post("api/apps/calendar/event",{event:e}).pipe((0,p.U)(e=>(this._events.next(t),e)))))}updateEvent(e,t){return this.events$.pipe((0,r.q)(1),(0,d.w)(n=>this._httpClient.patch("api/apps/calendar/event",{id:e,event:t}).pipe((0,p.U)(t=>{const s=n.findIndex(t=>t.id===e);return n[s]=t,this._events.next(n),t}))))}updateRecurringEvent(e,t,n){return this._httpClient.patch("api/apps/calendar/recurring-event",{event:e,originalEvent:t,mode:n})}deleteEvent(e){return this.events$.pipe((0,r.q)(1),(0,d.w)(t=>this._httpClient.delete("api/apps/calendar/event",{params:{id:e}}).pipe((0,p.U)(n=>{const s=t.findIndex(t=>t.id===e);return t.splice(s,1),this._events.next(t),n}))))}deleteRecurringEvent(e,t){return this._httpClient.delete("api/apps/calendar/recurring-event",{params:{event:JSON.stringify(e),mode:t}})}getSettings(){return this._httpClient.get("api/apps/calendar/settings").pipe((0,i.b)(e=>{this._settings.next(e)}))}updateSettings(e){return this.events$.pipe((0,r.q)(1),(0,d.w)(t=>this._httpClient.patch("api/apps/calendar/settings",{settings:e}).pipe((0,p.U)(t=>(this._settings.next(e),this.getWeekdays().subscribe(),t)))))}getWeekdays(){return this._httpClient.get("api/apps/calendar/weekdays").pipe((0,i.b)(e=>{this._weekdays.next(e)}))}}return e.\u0275fac=function(t){return new(t||e)(l.LFG(h.eN))},e.\u0275prov=l.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()}}]);