"use strict";(self.webpackChunksocio=self.webpackChunksocio||[]).push([[592],{4796:(C,u,r)=>{r.d(u,{o:()=>E});var _=r(6215),c=r(5917),o=r(3342),p=r(5257),d=r(3190),i=r(8002),v=r(7716),g=r(1841);let E=(()=>{class l{constructor(e){this._httpClient=e,this._calendars=new _.X(null),this._events=new _.X(null),this._loadedEventsRange={start:null,end:null},this._numberOfDaysToPrefetch=60,this._settings=new _.X(null),this._weekdays=new _.X(null)}get calendars$(){return this._calendars.asObservable()}get events$(){return this._events.asObservable()}get settings$(){return this._settings.asObservable()}get weekdays$(){return this._weekdays.asObservable()}getCalendars(){return this._httpClient.get("api/apps/calendar/calendars").pipe((0,o.b)(e=>{this._calendars.next(e)}))}addCalendar(e){return this.calendars$.pipe((0,p.q)(1),(0,d.w)(t=>this._httpClient.post("api/apps/calendar/calendars",{calendar:e}).pipe((0,i.U)(n=>(t.push(n),this._calendars.next(t),n)))))}updateCalendar(e,t){return this.calendars$.pipe((0,p.q)(1),(0,d.w)(n=>this._httpClient.patch("api/apps/calendar/calendars",{id:e,calendar:t}).pipe((0,i.U)(s=>{const a=n.findIndex(h=>h.id===e);return n[a]=s,this._calendars.next(n),s}))))}deleteCalendar(e){return this.calendars$.pipe((0,p.q)(1),(0,d.w)(t=>this._httpClient.delete("api/apps/calendar/calendars",{params:{id:e}}).pipe((0,i.U)(n=>{const s=t.findIndex(h=>h.id===e);t.splice(s,1),this._calendars.next(t);const a=this._events.value.filter(h=>h.calendarId!==e);return this._events.next(a),n}))))}getEvents(e,t,n=!1){return(n||!this._loadedEventsRange.start||e.isBefore(this._loadedEventsRange.start))&&(this._loadedEventsRange.start=e),(n||!this._loadedEventsRange.end||t.isAfter(this._loadedEventsRange.end))&&(this._loadedEventsRange.end=t),this._httpClient.get("api/apps/calendar/events",{params:{start:e.toISOString(!0),end:t.toISOString(!0)}}).pipe((0,d.w)(s=>this._events.pipe((0,p.q)(1),(0,i.U)(a=>(n?this._events.next(s):(a=a||[],this._events.next([...a,...s])),s)))))}reloadEvents(){return this._httpClient.get("api/apps/calendar/events",{params:{start:this._loadedEventsRange.start.toISOString(),end:this._loadedEventsRange.end.toISOString()}}).pipe((0,i.U)(e=>(this._events.next(e),e)))}prefetchFutureEvents(e){const t=this._loadedEventsRange.end.diff(e,"days");if(t>=this._numberOfDaysToPrefetch)return(0,c.of)([]);const n=this._loadedEventsRange.end.clone().add(1,"day");return e=this._loadedEventsRange.end.clone().add(this._numberOfDaysToPrefetch-t,"days"),this.getEvents(n,e)}prefetchPastEvents(e){const t=e.diff(this._loadedEventsRange.start,"days");if(t>=this._numberOfDaysToPrefetch)return(0,c.of)([]);e=this._loadedEventsRange.start.clone().subtract(this._numberOfDaysToPrefetch-t,"days");const n=this._loadedEventsRange.start.clone().subtract(1,"day");return this.getEvents(e,n)}addEvent(e){return this.events$.pipe((0,p.q)(1),(0,d.w)(t=>this._httpClient.post("api/apps/calendar/event",{event:e}).pipe((0,i.U)(n=>(this._events.next(t),n)))))}updateEvent(e,t){return this.events$.pipe((0,p.q)(1),(0,d.w)(n=>this._httpClient.patch("api/apps/calendar/event",{id:e,event:t}).pipe((0,i.U)(s=>{const a=n.findIndex(h=>h.id===e);return n[a]=s,this._events.next(n),s}))))}updateRecurringEvent(e,t,n){return this._httpClient.patch("api/apps/calendar/recurring-event",{event:e,originalEvent:t,mode:n})}deleteEvent(e){return this.events$.pipe((0,p.q)(1),(0,d.w)(t=>this._httpClient.delete("api/apps/calendar/event",{params:{id:e}}).pipe((0,i.U)(n=>{const s=t.findIndex(a=>a.id===e);return t.splice(s,1),this._events.next(t),n}))))}deleteRecurringEvent(e,t){return this._httpClient.delete("api/apps/calendar/recurring-event",{params:{event:JSON.stringify(e),mode:t}})}getSettings(){return this._httpClient.get("api/apps/calendar/settings").pipe((0,o.b)(e=>{this._settings.next(e)}))}updateSettings(e){return this.events$.pipe((0,p.q)(1),(0,d.w)(t=>this._httpClient.patch("api/apps/calendar/settings",{settings:e}).pipe((0,i.U)(n=>(this._settings.next(e),this.getWeekdays().subscribe(),n)))))}getWeekdays(){return this._httpClient.get("api/apps/calendar/weekdays").pipe((0,o.b)(e=>{this._weekdays.next(e)}))}}return l.\u0275fac=function(e){return new(e||l)(v.LFG(g.eN))},l.\u0275prov=v.Yz7({token:l,factory:l.\u0275fac,providedIn:"root"}),l})()}}]);